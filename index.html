<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bulanga SS | Pro Studio</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --gold: #D4AF37; --bg: #0a0a0a; --glass: rgba(255,255,255,0.1); }
        body { margin: 0; background: var(--bg); color: white; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; }
        
        /* Dynamic Header */
        .header { padding: 15px; text-align: center; border-bottom: 1px solid var(--glass); }
        .school-name { color: var(--gold); font-size: 1.2rem; letter-spacing: 2px; margin: 0; }

        /* The Viewport */
        #studio-core { flex: 1; position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center; background: #000; }
        video, #overlay-img { position: absolute; width: 100%; height: 100%; object-fit: cover; }
        #overlay-img { z-index: 5; display: none; pointer-events: none; }

        /* Professional Control Dock */
        .control-dock { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; 
            padding: 20px; background: rgba(0,0,0,0.9); border-top: 1px solid var(--gold);
        }
        
        button { 
            padding: 15px 5px; border-radius: 8px; border: 1px solid var(--glass);
            background: var(--glass); color: white; font-weight: bold; font-size: 10px;
        }
        .active-rec { background: #ff3333 !important; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        
        #file-input { display: none; }
    </style>
</head>
<body>

<div class="header">
    <h1 class="school-name">BULANGA SECONDARY SCHOOL</h1>
    <small style="letter-spacing:3px; color: grey;">PROGRESSIVE STUDIO</small>
</div>

<div id="studio-core">
    <video id="v-out" autoplay playsinline muted></video>
    <img id="overlay-img" src="" alt="Gallery Overlay">
</div>

<div class="control-dock">
    <button onclick="initApp()" id="status-btn">üü¢ START ENGINE</button>
    <button onclick="document.getElementById('file-input').click()">üìÅ UPLOAD</button>
    <button onclick="takeScreenshot()">üì∏ SNAP</button>
    <button id="rec-btn" onclick="handleRecord()" style="grid-column: span 3; background: #222; border: 1px solid #ff3333; color: #ff3333;">‚è∫ START RECORDING</button>
</div>

<input type="file" id="file-input" accept="image/*" onchange="loadGalleryImage(event)">

<script>
    let stream, recorder, chunks = [];
    const vOut = document.getElementById('v-out');
    const recBtn = document.getElementById('rec-btn');
    const overlay = document.getElementById('overlay-img');

    async function initApp() {
        stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        vOut.srcObject = stream;
        document.getElementById('status-btn').innerText = "LIVE";
        document.getElementById('status-btn').style.color = "#22c55e";
    }

    // UPLOAD FROM GALLERY
    function loadGalleryImage(event) {
        const reader = new FileReader();
        reader.onload = () => {
            overlay.src = reader.result;
            overlay.style.display = 'block';
        };
        reader.readAsDataURL(event.target.files[0]);
    }

    // SAVE PICTURE TO GALLERY
    async function takeScreenshot() {
        const canvas = await html2canvas(document.getElementById('studio-core'));
        const link = document.createElement('a');
        link.download = `Bulanga_Capture_${Date.now()}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
    }

    // REAL RECORDING LOGIC
    function handleRecord() {
        if (recorder?.state === "recording") {
            recorder.stop();
            recBtn.innerText = "‚è∫ START RECORDING";
            recBtn.classList.remove('active-rec');
        } else {
            chunks = [];
            recorder = new MediaRecorder(stream);
            recorder.ondataavailable = e => chunks.push(e.data);
            recorder.onstop = () => {
                const blob = new Blob(chunks, { type: 'video/mp4' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = "Studio_Export.mp4";
                a.click();
            };
            recorder.start();
            recBtn.innerText = "‚èπ STOP RECORDING";
            recBtn.classList.add('active-rec');
        }
    }
</script>
</body>
</html>

